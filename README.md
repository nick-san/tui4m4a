# tui4m4a

M4AファイルのメタデータをVimライクなキー操作で編集するための、Python製TUI（テキストUI）ツールです。

## 主な機能

* **Vimライクなキー操作**: `h, j, k, l`での移動、`:`から始まるコマンド (`:wq`, `:q!`) に対応。
* **効率的なUI**: 2ペイン構成で、左にファイル一覧、右にタグ情報を表示。
* **一括編集モード**: 複数のファイルを選択し、アルバム名やアーティスト名を一度に変更可能。
* **変更のプレビュー**: 編集内容は`Ctrl+S`や`:wq`で明示的に保存するまでファイルに書き込まれません。変更されたファイルには`[+]`マークが表示されます。
* **主要なM4Aタグに対応**: タイトル、アーティスト、アルバム、年、トラック番号などの編集が可能です。

---

## 要件

* **Python 3.8** 以上
* **`mutagen`** ライブラリ
* **`curses`**
    * Linux / macOS ではPythonの標準ライブラリに含まれています。
    * Windowsの場合は`windows-curses`が必要です (`pip install windows-curses`)。

---

## 🚀 インストールと実行

1.  リポジトリをクローンします。
    ```bash
    git clone [https://github.com/nick-san/tui4m4a.git](https://github.com/nick-san/tui4m4a.git)
    cd tui4m4a
    ```

2.  (venv環境に入ります)
    ```bash
    python3 -m venv .venv
    source .venv/activate
    ```

3.  必要なライブラリをインストールします。
    ```bash
    pip install -r requirements.txt
    ```
4.  起動用ラッパースクリプトに実行権限を渡し、パスが通っている所にリンクを貼ります。
    ```bash
    chmod +x tui4m4a
    ln -s ./tui4m4a ~/.local/bin (例)
    ```

5.  `m4a`ファイルがある場所に行き、`tui4m4a`を実行します。
    ```bash
    cd /your/music/storage/
    tui4m4a
    ```

    カレントディレクトリにある`.m4a`ファイルが一覧表示されます。


---

## ⌨️ 操作方法

### ナビゲーション
| キー | アクション |
| :--- | :--- |
| `j` / `↓` | 下に移動 |
| `k` / `↑` | 上に移動 |
| `l` / `Tab` | 右のタグ編集ペインに移動 |
| `h` / `Tab` | 左のファイル一覧ペインに移動 |

### 編集と保存
| キー | アクション |
| :--- | :--- |
| `Space` | （ファイル一覧で）ファイルを選択（マーク）/ 解除 |
| `Enter` | （タグ編集で）選択中のタグを編集モードにする |
| `Ctrl + S` | 全ての変更をファイルに保存する |
| `:` | コマンドモードに入る |

#### Bulk Edit

[Yazi](https://yazi-rs.github.io)のbulk rename のような一括編集モードがあります。

1. 左側のペインで 一括編集の対象にしたいファイルを選択した状態で、Spaceキーを押下する。
2. 右側のペインで 一括編集したい属性を選択した状態で、Enterキーを押下する。
3. Vimが起動するので、変更を加え、終わったら:wqで終了する。
4. 確認ダイアログが出るのでyを押下し終了する。
5. メインメニューに戻るので、:wqで変更を保存し終了 または :q!で変更を破棄して終了する。

### コマンドモード
| コマンド | アクション |
| :--- | :--- |
| `:wq` | 全ての変更を保存して終了する |
| `:q!` | 変更を破棄して強制終了する |
| `:q` | 未保存の変更がなければ終了する |
| `:FilenameToTitle` | 選択されたファイルのタイトルを、拡張子を除くファイル名にする |
